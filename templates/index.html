<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ direction }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ ui.title }}</title>
    <meta name="theme-color" content="#070914">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
    <link rel="icon" href="{{ url_for('static', filename='icons/icon-192.png') }}" type="image/png">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="orb orb-a" aria-hidden="true"></div>
<div class="orb orb-b" aria-hidden="true"></div>
<div class="orb orb-c" aria-hidden="true"></div>

<div class="app-shell">
    <header class="app-header">
        <a class="brand" href="{{ url_for('home', lang=lang) }}">
            <span class="brand-mark" aria-hidden="true">SS</span>
            <span class="brand-stack">
                <span class="brand-name">{{ ui.brand }}</span>
                <span class="brand-tag">{{ ui.tagline }}</span>
            </span>
        </a>

        <div class="header-actions">
            <a class="download-link" href="{{ url_for('download_page', lang=lang) }}">{{ ui.download_app }}</a>
            <button class="install-btn" id="installApp" type="button" hidden>{{ ui.install }}</button>
            <a class="lang-toggle" href="{{ url_for('home', lang=toggle_lang) }}">{{ ui.toggle }}</a>
        </div>
    </header>

    <main class="main-grid">
        <section class="hero reveal">
            <h1 class="hero-title"><span>{{ ui.hero_title }}</span></h1>
            <p class="hero-text">{{ ui.hero_text }}</p>

            <div class="badges" aria-label="Highlights">
                <span class="badge">{{ ui.badge_1 }}</span>
                <span class="badge">{{ ui.badge_2 }}</span>
                <span class="badge">{{ ui.badge_3 }}</span>
            </div>

            <div class="example">
                <span class="example-label">{{ ui.example_label }}:</span>
                <code class="example-code">{{ ui.example_text }}</code>
            </div>

            <ul class="features">
                <li class="feature">
                    <span class="feature-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M10.2 13.8a4.5 4.5 0 0 1 0-6.3l1.3-1.3a4.5 4.5 0 1 1 6.3 6.3l-1 1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                            <path d="M13.8 10.2a4.5 4.5 0 0 1 0 6.3l-1.3 1.3a4.5 4.5 0 1 1-6.3-6.3l1-1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                        </svg>
                    </span>
                    <div class="feature-body">
                        <div class="feature-title">{{ ui.feature_1_title }}</div>
                        <div class="feature-text">{{ ui.feature_1_text }}</div>
                    </div>
                </li>
                <li class="feature">
                    <span class="feature-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M7 18l-3 2V6a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H9l-2-2z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                            <path d="M8 9h8M8 13h6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                        </svg>
                    </span>
                    <div class="feature-body">
                        <div class="feature-title">{{ ui.feature_2_title }}</div>
                        <div class="feature-text">{{ ui.feature_2_text }}</div>
                    </div>
                </li>
                <li class="feature">
                    <span class="feature-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M12 2l8 4v6c0 5-3.5 9.3-8 10-4.5-.7-8-5-8-10V6l8-4z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                            <path d="M8.6 12.2l2.2 2.3 4.6-4.8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <div class="feature-body">
                        <div class="feature-title">{{ ui.feature_3_title }}</div>
                        <div class="feature-text">{{ ui.feature_3_text }}</div>
                    </div>
                </li>
            </ul>

            <div class="hero-art" aria-hidden="true">
                <img src="{{ url_for('static', filename='hero-security.svg') }}" alt="">
            </div>
        </section>

        <section class="scan reveal">
            <div class="scan-card">
                <div class="scan-head">
                    <h2 class="scan-title">{{ ui.scan_title }}</h2>
                    <p class="scan-subtitle">{{ ui.scan_subtitle }}</p>
                </div>

                <form method="POST" class="scan-form">
                    <input type="hidden" name="lang" value="{{ lang }}">
                    <input type="hidden" name="action" value="scan">
                    <textarea name="text" placeholder="{{ ui.placeholder }}" required>{{ user_input }}</textarea>
                    <button type="submit">{{ ui.check }}</button>
                    <p class="privacy">{{ ui.privacy_note }}</p>
                </form>

                {% if result %}
                <div class="result-box {{ result_class }}">
                    <div class="result-top">
                        <div class="result-status">
                            <span class="result-icon" aria-hidden="true">{{ icon }}</span>
                            <span class="result-label">{{ result }}</span>
                        </div>
                    </div>

                    {% if message %}
                    <p class="message">{{ message }}</p>
                    {% endif %}

                    {% if confidence is not none %}
                    <div class="meter">
                        <div class="meter-head">
                            <span class="meter-label">{{ ui.confidence }}</span>
                            <span class="meter-value">{{ confidence }}%</span>
                        </div>
                        <div class="bar">
                            <div class="fill" style="width: {{ confidence }}%"></div>
                        </div>
                    </div>
                    {% endif %}

                    {% if text_details or url_details is not none %}
                    <div class="detail-grid">
                        {% if text_details %}
                        <div class="detail-card">
                            <div class="detail-head">
                                <span class="detail-title">{{ ui.text_analysis_title }}</span>
                                <span class="detail-pill {{ text_details.result_class }}">
                                    <span class="detail-pill-icon" aria-hidden="true">{{ text_details.icon }}</span>
                                    <span class="detail-pill-label">{{ text_details.label }}</span>
                                </span>
                            </div>
                            <p class="detail-message">{{ text_details.message }}</p>
                            {% if text_details.reasons %}
                            <ul class="reason-list">
                                {% for r in text_details.reasons %}
                                <li>{{ r }}</li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            {% if text_details.confidence is not none %}
                            <div class="mini-meter {{ text_details.result_class }}">
                                <div class="mini-head">
                                    <span class="mini-label">{{ ui.nlp_confidence }}</span>
                                    <span class="mini-value">{{ text_details.confidence }}%</span>
                                </div>
                                <div class="bar">
                                    <div class="fill" style="width: {{ text_details.confidence }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}

                        <div class="detail-card">
                            <div class="detail-head">
                                <span class="detail-title">{{ ui.url_checks_title }}</span>
                                {% if url_details %}
                                <span class="detail-count">{{ url_details|length }}</span>
                                {% endif %}
                            </div>

                            {% if url_details %}
                            <div class="url-list">
                                {% for u in url_details %}
                                <div class="url-item {{ u.result_class }}">
                                    <div class="url-item-top">
                                        <span class="url-item-icon" aria-hidden="true">{{ u.icon }}</span>
                                        <span class="url-item-label">{{ u.label }}</span>
                                        <span class="url-item-conf">{{ u.confidence }}%</span>
                                    </div>
                                    <div class="url-item-value">{{ u.url }}</div>
                                    <div class="url-item-msg">{{ u.message }}</div>
                                    {% if u.reasons %}
                                    <ul class="reason-list reason-list--compact">
                                        {% for r in u.reasons %}
                                        <li>{{ r }}</li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p class="urls-none">{{ ui.urls_none }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <div class="history">
                    <div class="history-head">
                        <h3 class="history-title">{{ ui.history_title }}</h3>

                        {% if history %}
                        <form method="POST" class="history-actions">
                            <input type="hidden" name="lang" value="{{ lang }}">
                            <input type="hidden" name="action" value="clear_history">
                            <button type="submit" class="history-clear">{{ ui.clear_history }}</button>
                        </form>
                        {% endif %}
                    </div>

                    {% if history %}
                    <div class="chat" id="history">
                        {% for item in history %}
                        <div class="chat-block user">
                            <div class="chat-meta">
                                <span class="chat-who">{{ ui.you }}</span>
                                <span class="chat-kind">{{ ui[item.kind] }}</span>
                                <span class="chat-when">{{ item.at }}</span>
                            </div>
                            <div class="bubble bubble-user">{{ item.input }}</div>
                        </div>

                        <div class="chat-block bot">
                            <div class="bubble bubble-bot {{ item.result_class }}">
                                <div class="bubble-title">
                                    <span class="bubble-icon" aria-hidden="true">{{ item.icon }}</span>
                                    <span class="bubble-label">{{ ui[item.result_class] }}</span>
                                    {% if item.confidence is not none %}
                                    <span class="bubble-conf">{{ item.confidence }}%</span>
                                    {% endif %}
                                </div>
                                <div class="bubble-text">{{ item.message }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <p class="history-note">{{ ui.history_note }}</p>
                    {% else %}
                    <p class="history-empty">{{ ui.history_empty }}</p>
                    {% endif %}
                </div>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        {{ ui.footer }}
    </footer>
</div>

<script>
    (function () {
        var el = document.getElementById('history');
        if (el) {
            el.scrollTop = el.scrollHeight;
        }
    })();
</script>

<script>
    (function () {
        if (!("serviceWorker" in navigator)) return;

        // Avoid reloading on first install; reload only when an update takes over.
        var hadController = !!navigator.serviceWorker.controller;

        window.addEventListener("load", function () {
            navigator.serviceWorker
                .register("{{ url_for('service_worker') }}", { scope: "/" })
                .then(function (reg) {
                    try { reg.update(); } catch (e) { }
                })
                .catch(function () { });
        });

        navigator.serviceWorker.addEventListener("controllerchange", function () {
            if (!hadController) {
                hadController = true;
                return;
            }
            if (window.__swReloading) return;
            window.__swReloading = true;
            window.location.reload();
        });
    })();
</script>

<script>
    (function () {
        var installBtn = document.getElementById('installApp');
        if (!installBtn) return;

        var deferredPrompt = null;

        window.addEventListener('beforeinstallprompt', function (e) {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.hidden = false;
        });

        window.addEventListener('appinstalled', function () {
            deferredPrompt = null;
            installBtn.hidden = true;
        });

        installBtn.addEventListener('click', function () {
            if (!deferredPrompt) return;
            installBtn.disabled = true;
            deferredPrompt.prompt();

            deferredPrompt.userChoice
                .then(function () {
                    deferredPrompt = null;
                    installBtn.hidden = true;
                })
                .catch(function () {
                    deferredPrompt = null;
                })
                .then(function () {
                    installBtn.disabled = false;
                });
        });
    })();
</script>

</body>
</html>
